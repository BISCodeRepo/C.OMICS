<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gene</title>
</head>

<body>


  <div id="heatmapDiv" style="width: 90%; height: 600px;margin: auto;"></div>

  <script>


    var matrix = []
    var rowHeader = []
    var metaData = []
    var patientData = []


    $.ajax({
      type: "GET",
      url: "../file/NMF_meta.csv",
      dataType: "text",
      cache: false,
      success: function (data) {
        data = data.split("\n");
        const patientHeader = []
        data.map((row) => {
          const rowData = row.split(",");
          patientHeader.push(rowData[0])
          patientData.push(rowData.slice(1))
        });
        for (let i = 0; i < patientHeader.length; i++) {
          metaData.push({
            name: patientHeader[i],
            array: patientData[i]
          })
        }

        $.ajax({
          type: "GET",
          url: "../file/Quantitation_genes.csv",
          dataType: "text",
          cache: false,
          success: function (data) {
            data = data.split("\n");
            let rows = data.slice(1).map((row) => row.split(","));
            rows.map((row) => {
              rowHeader.push(row[0])
            });
            rows.map((row) => {
              matrix.push(row.slice(1))
            });
            drawHeatMap(matrix, rowHeader);
          },
        });
      },
    });


    //draw
    function drawHeatMap(data, rowHeader) {
      let json = {
        rows: rowHeader.length,
        columns: patientData[0].length,
        seriesArrays: [data],
        seriesDataTypes: ["Float32"],
        seriesNames: ["Gene"],
        rowMetadataModel: {
          vectors: [
            {
              name: "Gene",
              array: rowHeader,
            },
          ],
        },
        columnMetadataModel: {
          vectors: metaData
        },
      };

      new morpheus.HeatMap({
        el: $('#heatmapDiv'),
        dataset: morpheus.Dataset.fromJSON(json),
        colorScheme: {
          type: 'fixed',
          map: [{
            value: 2000,
            color: '#0000ff'
          }, {
            value: 1000,
            color: '#ffffff'
          }, {
            value: 0,
            color: '#ff0000'
          }]
        },
      });
      menu: toolbarMenu
    }




  </script>
</body>

</html>